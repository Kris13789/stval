<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sign in</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="auth-page">
    <div class="app-layout">
      <main class="content">
        <div class="page">
          <header class="page-header">
            <h1>St. Valentine's Gift Shop</h1>
            <p class="page-subtitle">Sign in to continue</p>
          </header>
          <button type="button" class="btn" id="signInWithGoogle">Sign in with Google</button>
        </div>
      </main>
    </div>

    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

      const SUPABASE_URL = "https://hmmipguhjbklimihatii.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhtbWlwZ3VoamJrbGltaWhhdGlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4OTQ4NTAsImV4cCI6MjA4NTQ3MDg1MH0.hpoe40z9M8abumchMFm_5lSDX5kKgpB2UHiaCRixOFY";

      const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      const btn = document.getElementById("signInWithGoogle");
      const redirectTo = new URL("auth-callback.html", window.location.href).toString();

      btn.addEventListener("click", async () => {
        btn.disabled = true;
        const { data, error } = await supabase.auth.signInWithOAuth({
          provider: "google",
          options: { redirectTo },
        });
        if (error) {
          console.error("Sign in error:", error);
          btn.disabled = false;
          return;
        }
        if (data?.url) {
          window.location.href = data.url;
        } else {
          btn.disabled = false;
        }
      });
    </script>
  </body>
</html>
